/*
 * File: app/view/ResultsContainer.js
 * Date: Tue Nov 29 2011 22:08:43 GMT+0000 (GMT)
 *
 * This file was generated by Ext Designer version 1.2.2.
 * http://www.sencha.com/products/designer/
 *
 * This file will be generated the first time you export.
 *
 * You should implement event handling and custom methods in this
 * class.
 */

Ext.define('Superfastmatch.view.ResultsContainer', {
    extend: 'Superfastmatch.view.ui.ResultsContainer',
    alias: 'widget.resultscontainer',
    requires: ['Superfastmatch.store.Fragments'],

    allFragments: '',
    selectedFragments: '',

    initComponent: function() {
        var me = this;
        me.callParent(arguments);
        me.allFragments=Ext.create('Superfastmatch.store.Fragments');
        me.selectedFragments=Ext.create('Superfastmatch.store.Fragments');
        me.down('#fragmentTextColumn').renderer=me.columnWrap;
        me.down('#Documents').on('reconfigure',me.buildFragments,me);
        me.down('#Documents').on('selectionchange',me.buildFragments,me);
        me.down('#Fragments').on('itemmouseenter',me.highlightFragment,me);
        me.down('#Fragments').on('itemmouseleave',me.unHighlightFragment,me);
        me.addEvents('highlightchange');
    },

    highlightFragment: function(view,record){
        this.fireEvent('highlightchange',{action:'enter',start: record.get('from'),length: record.get('length')});
    },
    
    unHighlightFragment: function(view,record){
        this.fireEvent('highlightchange',{action:'leave',start: record.get('from'),length: record.get('length')});
    },

    buildFragments: function(){
        var selected=this.down('#Documents').getSelectionModel().getSelection();
        this.down('#Fragments').suspendEvents();
        if (selected.length==0){
            this.allFragments.loadDocuments(this.down('#Documents').getStore().data.items);
            this.down('#Fragments').reconfigure(this.allFragments);
            this.down('#Fragments').setTitle('Fragments (All Documents)');
        }else{
            this.selectedFragments.loadDocuments(selected);
            this.down('#Fragments').reconfigure(this.selectedFragments);
            this.down('#Fragments').setTitle('Fragments ('+selected.length+' Document'+((selected.length>1)?'s':'')+')');
        }
        this.down('#Fragments').resumeEvents();
    },

    columnWrap: function(val){
        return '<div style="white-space:normal !important;"><pre class="wrap">'+ val +'</pre></div>';
    },
    
    
});